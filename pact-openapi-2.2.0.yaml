openapi: 3.1.0
info:
  title: PACT API Specification
  summary: Technical Specifications for PCF Data Exchange (Version 2.2.0)
  version: 2.2.0
  contact: 
    name: WBCSD PACT Project
    url: https://github.com/wbcsd
    email: pact@wbcsd.org
  description: >
    This document describes the technical specifications for the exchange of 
    Product Carbon Footprint (PCF) data between systems. The specification is 
    maintained by the WBCSD PACT project and  intended to be used by organizations 
    that wish to exchange PCF data with other organizations. The specifications 
    are designed to be technology-agnostic. 
paths:
  /footprints:
    get:
      summary: Action ListFootprints
      description: >
        Retrieve a list of Product Carbon Footprints (PCFs) that are available. 
        The list can be filtered by various criteria.
      operationId: listFootprints
      tags: [footprint]
      parameters:
      - name: limit
        in: query
        schema:
          type: integer
          format: uint
          minimum: 0
      - name: '$filter'
        in: query
        description: Syntax as defined by the ODatav4 specification
        allowEmptyValue: true
        schema:
          type: string
      responses:
        '200':
          description: Success
          headers:
            link:
              description: Link header to next result set. See Tech Specs section 6.6.1
              schema:
                type: string
              example: https://api.example.com/2/footprints?[...]
          content:
            application/json:
              schema:
                type: object
                required:
                - data
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProductFootprint'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - BearerAuth: []
  /footprints/{id}:
    get:
      summary: Action GetFootprint
      description: ^
        Retrieve a single Product Carbon Footprint (PCF) by its unique identifier.
      operationId: getFootprintById
      tags: [footprint]
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                description: HTTP Body of Action `GetFootprint`
                type: object
                required:
                - data
                properties:
                  data:
                    $ref: '#/components/schemas/ProductFootprint'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - BearerAuth: []
  /events:
    post:
      summary: Action Event
      description: >
        Post an event to the system. The event will be processed by the system 
        and may trigger further actions.
      operationId: post_event
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PathfinderEvent'
      responses:
        '200':
          description: Success
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '501':
          description: Not implemented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
      - BearerAuth: []
components:
  schemas:
    ProductFootprint:
      description: >
        The ProductFootprint is a data type which represents the footprint
        of a product under a specific scope (§ 5.2.1 Scope of a Footprint) 
        and with values calculated in accordance with the PACT Framework.
        
        Conceptually, the data type ProductFootprint is modeled as a multi-purpose 
        container for product-specific emissions factors which is supported by 
        extensibility through Data Model Extensions.

        Each ProductFootprint can and should be updated over time, for instance 
        to incorporate new or refined data from data owners (see § 6 Product 
        Footprint Lifecycle). 
      type: object
      title: ProductFootprint
      required:
      - id
      - specVersion
      - version
      - created
      - status
      - comment
      - companyName
      - companyIds
      - productDescription
      - productIds
      - productCategoryCpc
      - productNameCompany
      - pcf
      properties:
        id:
          type: string
          format: uuid
        specVersion:
          type: string
          pattern: '^\d+\.\d+\.\d+(-\d{8})?$'
        precedingPfIds:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1
          uniqueItems: true
        version:
          type: integer
          format: int32
          maximum: 2147483647
          minimum: 0
        created:
          type: string
          format: date-time
        updated:
          type: string
          format: date-time
          nullable: true
        status:
          type: string
          enum:
            - Active
            - Deprecated
        statusComment:
          type: string
          nullable: true
        validityPeriodStart:
          type: string
          format: date-time
          nullable: true
        validityPeriodEnd:
          type: string
          format: date-time
          nullable: true
        companyName:
          $ref: '#/components/schemas/NonEmptyString'
        companyIds:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            $ref: '#/components/schemas/Urn'
        productDescription:
          type: string
        productIds:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            $ref: '#/components/schemas/Urn'
        productCategoryCpc:
          $ref: '#/components/schemas/NonEmptyString'
        productNameCompany:
          $ref: '#/components/schemas/NonEmptyString'
        comment:
          type: string
        pcf:
          $ref: '#/components/schemas/CarbonFootprint'
    NonEmptyString:
      type: string
      minLength: 1
    Urn:
      type: string
      pattern: '^([uU][rR][nN]):'
    CarbonFootprint:
      description: Data Type "CarbonFootprint" of Spec Version 2
      title: CarbonFootprint
      type: object
      required:
      - declaredUnit
      - unitaryProductAmount
      - referencePeriodStart
      - referencePeriodEnd
      - pCfExcludingBiogenic
      - fossilGhgEmissions
      - fossilCarbonContent
      - biogenicCarbonContent
      - characterizationFactors
      - ipccCharacterizationFactorsSources
      - crossSectoralStandardsUsed
      - boundaryProcessesDescription
      - exemptedEmissionsPercent
      - exemptedEmissionsDescription
      - packagingEmissionsIncluded
      - productOrSectorSpecificRules
      properties:
        declaredUnit:
          type: string
          enum:
            - liter
            - kilogram
            - cubic meter
            - kilowatt hour
            - megajoule
            - ton kilometer
            - square meter
        unitaryProductAmount:
          $ref: '#/components/schemas/PositiveNonZeroDecimal'
        pCfExcludingBiogenic:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        pCfIncludingBiogenic:
          $ref: '#/components/schemas/Decimal'
        fossilGhgEmissions:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        fossilCarbonContent:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        biogenicCarbonContent:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        dLucGhgEmissions:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        landManagementGhgEmissions:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        otherBiogenicGhgEmissions:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        iLucGhgEmissions:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        biogenicCarbonWithdrawal:
          $ref: '#/components/schemas/NegativeOrZeroDecimal'
        aircraftGhgEmissions:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        ipccCharacterizationFactorsSources:
          type: array
          items:
            type: string
            pattern: '^AR\d+$'
          minItems: 1
          uniqueItems: true
        crossSectoralStandardsUsed:
          type: array
          items:
            type: string
            enum:
              - GHG Protocol Product standard
              - ISO Standard 14067
              - ISO Standard 14044
          minItems: 1
          uniqueItems: true
        productOrSectorSpecificRules:
          description: >
            The product-specific or sector-specific rules applied for calculating or 
            allocating GHG emissions. Sector specific guidance frameworks, such as 
            Product Category Rules (PCR), are sets of rules for how to calculate and 
            document Life Cycle Assessments. They provide product category specific
            guidance and enhance comparability between assessments of the different 
            suppliers for the same category (sector). The same applies to Product 
            Environmental Footprint Category Rules (PEFCR)).  If no rules were used, 
            leave this field empty.
          type: array
          items:
            $ref: '#/components/schemas/ProductOrSectorSpecificRule'
          minItems: 1
          uniqueItems: true
        biogenicAccountingMethodology:
          type: string
          enum:
            - PEF
            - ISO
            - GHGP
            - Quantis
        boundaryProcessesDescription:
          type: string
        referencePeriodStart:
          type: string
          format: date-time
        referencePeriodEnd:
          type: string
          format: date-time
        geographyRegionOrSubregion:
          description: >
            The geographic representation of the PCF may be reported at different 
            levels of granularity, depending on the prefere of the data provider 
            (e.g., at a plant, region, or country level). This attribute specifies 
            the geographic region to which the PCF refers, i.e. "Africa", 
            "Central Asia", etc.
          type: string
          enum:
            - Africa
            - Americas
            - Asia
            - Europe
            - Oceania
            - Australia and New Zealand
            - Central Asia
            - Eastern Asia
            - Eastern Europe
            - Latin America and the Caribbean
            - Melanesia
            - Micronesia
            - Northern Africa
            - Northern America
            - Northern Europe
            - Polynesia
            - South-eastern Asia
            - Southern Asia
            - Southern Europe
            - Sub-Saharan Africa
            - Western Asia
            - Western Europe
        geographyCountry:
          description: >
            The geographic representation of the PCF may be reported at different levels
            of granularity, depending on the prefere of the data provider (e.g., at a 
            plant, region, or country level). This field indicates the country to which 
            the PCF refers. The country name must be according to ISO 3166-2 alpha-2 
            country code (https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)
          type: string
          pattern: '^[A-Z]{2}$'
          comment: ISO 3166-1 alpha-2
          examples:
            - US
            - DE
        geographyCountrySubdivision:
          description: >
            The geographic representation of the PCF may be reported at different 
            levels of granularity, depending on the prefere of the data provider 
            (e.g., at a plant, region, or country level). This attribute represents 
            the most granular (i.e. "most specific") geography, i.e. the specific 
            subdivision within a given country, for example New York State within 
            the USA. Follows ISO 3166-2.
          type: string
          pattern: '^[A-Z]{2}-[A-Z0-9]{1,3}$'
          comment: ISO 3166-2
          examples:
            - US-CA
            - DE-BW
        secondaryEmissionFactorSources:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/EmissionFactorDS'
        exemptedEmissionsPercent:
          $ref: '#/components/schemas/Percent'
          maximum: 5
        exemptedEmissionsDescription:
          type: string
        packagingEmissionsIncluded:
          type: boolean
        packagingGhgEmissions:
          $ref: '#/components/schemas/PositiveOrZeroDecimal'
        allocationRulesDescription:
          type: string
          nullable: true
        uncertaintyAssessmentDescription:
          type: string
          nullable: true
        primaryDataShare:
          $ref: '#/components/schemas/Percent'
        dqi:
          $ref: '#/components/schemas/DataQualityIndicators'
        assurance:
          $ref: '#/components/schemas/Assurance'
          nullable: true

    PositiveNonZeroDecimal:
      type: string
      pattern: '^(\\d*[1-9]\\d*([\\.]\\d+)?|\\d+(\\.\\d*[1-9]\\d*)?)$'
    PositiveOrZeroDecimal:
      type: string
      pattern: '^\\d+(\\.\\d+)?$'
    Decimal:
      type: string
      pattern: '^-?\\d+(\\.\\d+)?$'
    NegativeOrZeroDecimal:
      type: string
      pattern: '^(-\\d+(\\.\\d+)?)|0$'
    ProductOrSectorSpecificRule:
      type: object
      required:
      - operator
      - ruleNames
      properties:
        operator:
          type: string
          enum:
            - PEF
            - EPD International
            - Other
        ruleNames:
          type: array
          items:
            type: string
            minLength: 1
          minItems: 1
          uniqueItems: true
        otherOperatorName:
          $ref: '#/components/schemas/NonEmptyString'
    EmissionFactorDS:
      type: object
      required:
      - name
      - version
      properties:
        name:
          $ref: '#/components/schemas/NonEmptyString'
        version:
          $ref: '#/components/schemas/NonEmptyString'
    Percent:
      type: number
      format: double
      maximum: 100
      minimum: 0
    DataQualityIndicators:
      description: Data Type "DataQualityIndicators" of Spec Version 2
      title: DataQualityIndicators
      type: object
      required:
      - coveragePercent
      - technologicalDQR
      - temporalDQR
      - geographicalDQR
      - completenessDQR
      - reliabilityDQR
      properties:
        coveragePercent:
          $ref: '#/components/schemas/Percent'
        technologicalDQR:
          $ref: '#/components/schemas/PositiveNonZeroDecimal'
        temporalDQR:
          $ref: '#/components/schemas/PositiveNonZeroDecimal'
        geographicalDQR:
          $ref: '#/components/schemas/PositiveNonZeroDecimal'
        completenessDQR:
          $ref: '#/components/schemas/PositiveNonZeroDecimal'
        reliabilityDQR:
          $ref: '#/components/schemas/PositiveNonZeroDecimal'
    Assurance:
      description: Data Type "Assurance" of Spec Version 2
      title: Assurance
      type: object
      required:
      - assurance
      - providerName
      properties:
        assurance:
          type: boolean
        coverage:
          allOf:
          - $ref: '#/components/schemas/AssuranceCoverage'
          nullable: true
        level:
          allOf:
          - $ref: '#/components/schemas/AssuranceLevel'
          nullable: true
        boundary:
          allOf:
          - $ref: '#/components/schemas/AssuranceBoundary'
          nullable: true
        providerName:
          type: string
        completedAt:
          type: string
          format: date-time
          nullable: true
        standardName:
          type: string
          nullable: true
        comments:
          type: string
          nullable: true
    AssuranceCoverage:
      type: string
      enum:
      - corporate level
      - product line
      - PCF system
      - product level
    AssuranceLevel:
      type: string
      enum:
      - limited
      - reasonable
    AssuranceBoundary:
      type: string
      enum:
      - Gate-to-Gate
      - Cradle-to-Gate

    # -----------
    # Event Types
    PathfinderEvent:
      description: possible contents of `data` property of events - see tech specs
        section 6 for details
      type: object
      oneOf:
      - description: "the contents of the `data` field of a `PF Update Event` – see
          Tech Specs section 6.8.3"
        type: object
        required:
        - data
        - type
        properties:
          type:
            type: string
            enum:
            - org.wbcsd.pathfinder.ProductFootprint.Published.v1
          data:
            $ref: '#/components/schemas/PFUpdateEventBody'
      - description: "the contents of the `data` field of a `PF Request Event` – see
          Tech Specs section 6.8.4.1"
        type: object
        required:
        - data
        - type
        properties:
          type:
            type: string
            enum:
            - org.wbcsd.pathfinder.ProductFootprintRequest.Created.v1
          data:
            $ref: '#/components/schemas/PFRequestEventBody'
      required:
      - id
      - source
      - specversion
      - time
      properties:
        specversion:
          type: string
        id:
          type: string
        source:
          type: string
        time:
          type: string
          format: date-time
    PFUpdateEventBody:
      type: object
      required:
      - pfIds
      properties:
        pfIds:
          type: array
          items:
            type: string
            format: uuid
    PFRequestEventBody:
      type: object
      required:
      - pf
      properties:
        pf: {}
        comment:
          type: string
          nullable: true    
    # ---------------
    # Error Responses
    ErrorResponse:
      title: ErrorResponse
      description: Response with an error code and descripton. See Chapter "Error
        Codes" of the Tech Specs for more details.
      type: object
      properties:
        code:
          type: string
          enum:
            - BadRequest
            - NotImplemented
            - AccessDenied
            - NoSuchFootprint
            - TokenExpired
            - InternalError
        message:
          type: string
      required:
      - code
      - message
  securitySchemes:
    BearerAuth:
      description: OAuth2 Client Credentials Grant (RFC6749 4.4)
      type: oauth2
      flows:
        clientCredentials:
          tokenUrl: '/auth/token'
          scopes:
            footprint:list: Ability to list footprints
            footprint:read: Ability to access individual footprints
